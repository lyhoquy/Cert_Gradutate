<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thiá»‡p ChÃºc Má»«ng Tá»‘t Nghiá»‡p</title>
    <link rel="stylesheet" href="spring.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body>
    <!-- Floating confetti -->
    <div class="floating-confetti" aria-hidden="true">
      <div
        class="confetti"
        style="left: 10%; animation-delay: 0s; background: #fd79a8"
      ></div>
      <div
        class="confetti"
        style="left: 25%; animation-delay: 1s; background: #fdcb6e"
      ></div>
      <div
        class="confetti"
        style="left: 40%; animation-delay: 2s; background: #00cec9"
      ></div>
      <div
        class="confetti"
        style="left: 55%; animation-delay: 0.5s; background: #74b9ff"
      ></div>
      <div
        class="confetti"
        style="left: 70%; animation-delay: 1.5s; background: #a29bfe"
      ></div>
      <div
        class="confetti"
        style="left: 85%; animation-delay: 2.5s; background: #ff7675"
      ></div>
    </div>

    <!-- Password Screen -->
    <div
      id="overlay"
      class="password-overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="password-title"
    >
      <form
        class="password-box"
        onsubmit="unlock(); return false;"
        autocomplete="off"
      >
        <h2 id="password-title">ğŸ” Nháº­p máº­t kháº©u</h2>
        <label for="passInput" class="visually-hidden">Máº­t kháº©u</label>
        <input
          type="password"
          id="passInput"
          placeholder="Nháº­p máº­t kháº©u..."
          autocomplete="off"
          required
          aria-required="true"
        />
        <br />
        <button type="submit">âœ¨ Má»Ÿ thiá»‡p âœ¨</button>
      </form>
    </div>

    <!-- Main Content -->
    <main id="content" style="display: none" tabindex="-1">
      <div id="captureArea">
        <section
          class="graduation-card"
          aria-label="Thiá»‡p chÃºc má»«ng tá»‘t nghiá»‡p"
        >
          <!-- Left side - Photo -->
          <div class="photo-section">
            <div class="decorative-elements" aria-hidden="true">
              <div
                class="star-left"
                style="top: 15%; left: 10%; animation-delay: 0s"
              >
                âœ¨
              </div>
              <div
                class="star-left"
                style="top: 25%; right: 15%; animation-delay: 1s"
              >
                â­
              </div>
              <div
                class="star-left"
                style="bottom: 20%; left: 15%; animation-delay: 0.5s"
              >
                âœ¨
              </div>
              <div
                class="star-left"
                style="bottom: 35%; right: 10%; animation-delay: 1.5s"
              >
                ğŸŒŸ
              </div>
            </div>
            <div class="graduation-cap-left" aria-hidden="true">ğŸ“</div>
            <div class="photo-container">
              <img
                src="./Pics/ngoc.png"
                alt="áº¢nh tá»‘t nghiá»‡p cá»§a Ngá»c"
                class="graduate-photo"
                loading="lazy"
              />
            </div>
          </div>

          <!-- Right side - Letter -->
          <section class="letter-section">
            <header class="letter-header">
              <h1 class="main-title">ğŸ‰ ChÃºc Má»«ng Tá»‘t Nghiá»‡p ğŸ‰</h1>
              <div class="graduate-name">
                <strong>Há»“ Thá»‹ Ãnh Ngá»c</strong><br />
              </div>
            </header>
            <article class="letter-content">
              <div class="achievement-badge">ğŸ“ Tá»‘t Nghiá»‡p â€“ Khá»Ÿi Äáº§u Má»›i</div>
              <div class="congratulation-message">
                <strong>ğŸ“ Gá»­i chá»‹ thÃ¢n máº¿n,</strong><br /><br />
                Váº­y lÃ  hÃ nh trÃ¬nh há»c táº­p cá»§a chá»‹ Ä‘Ã£ khÃ©p láº¡i vá»›i biáº¿t bao ná»—
                lá»±c vÃ  ká»· niá»‡m Ä‘Ã¡ng nhá»›. Em thá»±c sá»± ngÆ°á»¡ng má»™ sá»± kiÃªn trÃ¬ vÃ  cá»‘
                gáº¯ng khÃ´ng ngá»«ng nghá»‰ cá»§a chá»‹ suá»‘t thá»i gian qua. ğŸ’«<br /><br />
                Mong ráº±ng nhá»¯ng kiáº¿n thá»©c, nhá»¯ng tráº£i nghiá»‡m (vÃ  cáº£ nhá»¯ng pha
                â€œáº£nh dÃ¬mâ€ huyá»n thoáº¡i ğŸ˜Œ) sáº½ luÃ´n lÃ  hÃ nh trang quÃ½ giÃ¡ cho chá»‹
                bÆ°á»›c tiáº¿p tháº­t tá»± tin vÃ  vá»¯ng vÃ ng.<br /><br />
                <strong>ğŸŒ· Em tin tÆ°Æ¡ng lai cá»§a chá»‹</strong> sáº½ rá»±c rá»¡ vÃ  trÃ n
                ngáº­p niá»m vui, thÃ nh cÃ´ng cÃ¹ng nhá»¯ng Ä‘iá»u báº¥t ngá» thÃº vá»‹ Ä‘ang
                chá» phÃ­a trÆ°á»›c.<br /><br />
                <strong>ğŸ’– ChÃºc chá»‹ luÃ´n giá»¯ vá»¯ng báº£n lÄ©nh</strong>, tin vÃ o
                chÃ­nh mÃ¬nh vÃ  sá»‘ng trá»n tá»«ng khoáº£nh kháº¯c trÃªn hÃ nh trÃ¬nh má»›i!
              </div>

              <footer class="signature">
                ğŸ’Œ Gá»­i lá»i chÃºc tá»‘t Ä‘áº¹p nháº¥t,<br />
                <strong>Ly Há»“</strong> âœ¨
              </footer>
            </article>
          </section>
        </section>
      </div>
      <div
        class="action-buttons"
        style="
          margin-top: 25px;
          display: flex;
          justify-content: center;
          gap: 20px;
        "
      >
        <button
          id="downloadImageBtn"
          class="download-btn"
          title="Táº£i áº£nh thiá»‡p"
        >
          ğŸ“¸
        </button>
        <button id="shareBtn" class="download-btn" title="Chia sáº» liÃªn káº¿t">
          ğŸ”—
        </button>
      </div>
    </main>

    <script>
      function unlock() {
        const input = document.getElementById("passInput").value;
        if (input === "hothianhngoc") {
          document.getElementById("overlay").style.display = "none";
          document.getElementById("content").style.display = "block";
          document.getElementById("content").focus();
          document.getElementById("content").style.display = "block";
          document.querySelector(".graduation-card").classList.add("open-card");

          createContinuousConfetti();
        } else {
          alert("ğŸ” Sai máº­t kháº©u rá»“i! HÃ£y thá»­ láº¡i nhÃ© ğŸ’¡");
        }
      }

      function createContinuousConfetti() {
        const colors = [
          "#fd79a8",
          "#fdcb6e",
          "#00cec9",
          "#74b9ff",
          "#a29bfe",
          "#ff7675",
          "#55efc4",
        ];
        setInterval(() => {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.position = "fixed";
          confetti.style.left = Math.random() * 100 + "%";
          confetti.style.top = "-10px";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.pointerEvents = "none";
          confetti.style.zIndex = "10";
          confetti.style.animationDuration = Math.random() * 2 + 2 + "s";
          document.body.appendChild(confetti);
          setTimeout(() => {
            if (confetti.parentNode) {
              confetti.parentNode.removeChild(confetti);
            }
          }, 4000);
        }, 250);
      }

      // High-quality image download function
      document.getElementById("downloadImageBtn").onclick = async function () {
        const btn = document.getElementById("downloadImageBtn");

        // Disable button and show loading state
        btn.disabled = true;

        try {
          const card = document.getElementById("captureArea");

          // Update progress - preparing

          // Small delay to ensure all fonts and styles are loaded
          await new Promise((resolve) => setTimeout(resolve, 300));

          // Update progress - capturing

          // Capture with high quality settings
          const canvas = await html2canvas(card, {
            backgroundColor: null, // Keep transparent background
            useCORS: true,
            allowTaint: false,
            scale: 2, // Higher resolution - 2x scaling
            logging: false,
            width: card.offsetWidth,
            height: card.offsetHeight,
            windowWidth: document.body.scrollWidth,
            windowHeight: document.body.scrollHeight,
            removeContainer: false,
            imageTimeout: 15000,
            onclone: function (clonedDoc) {
              // Ensure all styles are applied in the cloned document
              const clonedCard = clonedDoc.querySelector(".graduation-card");
              if (clonedCard) {
                clonedCard.style.animation = "none";
                // Stop all animations for better capture
                const animatedElements = clonedDoc.querySelectorAll("*");
                animatedElements.forEach((el) => {
                  el.style.animation = "none";
                  el.style.transition = "none";
                });
              }
            },
          });

          // Convert to high-quality blob
          canvas.toBlob(
            function (blob) {
              // Create download link
              const url = URL.createObjectURL(blob);
              const link = document.createElement("a");
              link.href = url;
              link.download = "thiep-chuc-mung-tot-nghiep.png";
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);

              // Reset button state
              setTimeout(() => {
                btn.disabled = false;
                icon.textContent = "âœ…";
                text.textContent = "Táº£i xong! Nháº¥n Ä‘á»ƒ táº£i láº¡i";

                setTimeout(() => {
                  icon.textContent = "ğŸ“¸";
                  text.textContent = "Táº£i áº¢nh Thiá»‡p";
                }, 2500);
              }, 500);
            },
            "image/png",
            1.0
          ); // Maximum quality PNG
        } catch (error) {
          console.error("Error creating image:", error);

          // Reset button on error
          btn.disabled = false;
          icon.textContent = "âŒ";
          text.textContent = "Lá»—i! Thá»­ láº¡i";

          setTimeout(() => {
            icon.textContent = "ğŸ“¸";
            text.textContent = "Táº£i áº¢nh Thiá»‡p";
          }, 5000);

          alert("CÃ³ lá»—i xáº£y ra khi táº¡o áº£nh. Vui lÃ²ng thá»­ láº¡i!");
        }
      };

      document.getElementById("shareBtn").onclick = async function () {
        try {
          const url = window.location.href;
          await navigator.clipboard.writeText(url);
          const btn = document.getElementById("shareBtn");
          const original = btn.textContent;
          btn.textContent = "âœ…";
          setTimeout(() => {
            btn.textContent = original;
          }, 1500);
          alert("ğŸ“ ÄÃ£ sao chÃ©p link! Báº¡n cÃ³ thá»ƒ chia sáº» ngay.");
        } catch (err) {
          alert("KhÃ´ng thá»ƒ sao chÃ©p liÃªn káº¿t. TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£!");
        }
      };

      // Auto-focus password input
      window.onload = function () {
        document.getElementById("passInput").focus();
      };
    </script>
  </body>
</html>
