<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thiệp Chúc Mừng Tốt Nghiệp</title>
    <link rel="stylesheet" href="spring.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body>
    <!-- Floating confetti -->
    <div class="floating-confetti" aria-hidden="true">
      <div
        class="confetti"
        style="left: 10%; animation-delay: 0s; background: #fd79a8"
      ></div>
      <div
        class="confetti"
        style="left: 25%; animation-delay: 1s; background: #fdcb6e"
      ></div>
      <div
        class="confetti"
        style="left: 40%; animation-delay: 2s; background: #00cec9"
      ></div>
      <div
        class="confetti"
        style="left: 55%; animation-delay: 0.5s; background: #74b9ff"
      ></div>
      <div
        class="confetti"
        style="left: 70%; animation-delay: 1.5s; background: #a29bfe"
      ></div>
      <div
        class="confetti"
        style="left: 85%; animation-delay: 2.5s; background: #ff7675"
      ></div>
    </div>

    <!-- Password Screen -->
    <div
      id="overlay"
      class="password-overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="password-title"
    >
      <form
        class="password-box"
        onsubmit="unlock(); return false;"
        autocomplete="off"
      >
        <h2 id="password-title">🔐 Nhập mật khẩu</h2>
        <label for="passInput" class="visually-hidden">Mật khẩu</label>
        <input
          type="password"
          id="passInput"
          placeholder="Nhập mật khẩu..."
          autocomplete="off"
          required
          aria-required="true"
        />
        <br />
        <button type="submit">✨ Mở thiệp ✨</button>
      </form>
    </div>

    <!-- Main Content -->
    <main id="content" style="display: none" tabindex="-1">
      <div id="captureArea">
        <section
          class="graduation-card"
          aria-label="Thiệp chúc mừng tốt nghiệp"
        >
          <!-- Left side - Photo -->
          <div class="photo-section">
            <div class="decorative-elements" aria-hidden="true">
              <div
                class="star-left"
                style="top: 15%; left: 10%; animation-delay: 0s"
              >
                ✨
              </div>
              <div
                class="star-left"
                style="top: 25%; right: 15%; animation-delay: 1s"
              >
                ⭐
              </div>
              <div
                class="star-left"
                style="bottom: 20%; left: 15%; animation-delay: 0.5s"
              >
                ✨
              </div>
              <div
                class="star-left"
                style="bottom: 35%; right: 10%; animation-delay: 1.5s"
              >
                🌟
              </div>
            </div>
            <div class="graduation-cap-left" aria-hidden="true">🎓</div>
            <div class="photo-container">
              <img
                src="./Pics/ngoc.png"
                alt="Ảnh tốt nghiệp của Lài"
                class="graduate-photo"
                loading="lazy"
              />
            </div>
          </div>

          <!-- Right side - Letter -->
          <section class="letter-section">
            <header class="letter-header">
              <h1 class="main-title">🎉 Chúc Mừng Tốt Nghiệp 🎉</h1>
              <div class="graduate-name">
                <strong>Nguyễn Thị Lài</strong><br />
              </div>
            </header>
            <article class="letter-content">
              <div class="achievement-badge">🎓 Tốt Nghiệp – Khởi Đầu Mới</div>
              <div class="congratulation-message">
                <strong>🎓 Chị thân mến,</strong><br /><br />
                Tốt nghiệp không phải là kết thúc – mà là bước khởi đầu cho hành
                trình rực rỡ hơn, nơi ước mơ được chắp cánh bằng chính nỗ lực
                của chị trong suốt thời gian qua. 💪<br /><br />
                Em tin chị không chỉ giỏi – mà còn bản lĩnh, dám nghĩ, dám làm
                và dám sống thật với chính mình.<br /><br />
                <strong>🔥 Dù con đường phía trước có thử thách</strong>, thì
                chị vẫn luôn đủ mạnh mẽ để đi đến cùng – và em tin, còn đi xa
                hơn nữa!<br /><br />
                P/S: Nhớ học bài, bài ... 👀<br />
                <strong>🌈 Chúc chị luôn giữ vững ngọn lửa trong tim</strong>,
                và tỏa sáng theo cách rất riêng của mình!
              </div>

              <footer class="signature">
                💌 Gửi lời chúc tốt đẹp nhất,<br />
                <strong>Ly Hồ</strong> ✨
              </footer>
            </article>
          </section>
        </section>
      </div>
      <div
        class="action-buttons"
        style="
          margin-top: 25px;
          display: flex;
          justify-content: center;
          gap: 20px;
        "
      >
        <button
          id="downloadImageBtn"
          class="download-btn"
          title="Tải ảnh thiệp"
        >
          📸
        </button>
        <button id="shareBtn" class="download-btn" title="Chia sẻ liên kết">
          🔗
        </button>
      </div>
    </main>

    <script>
      function unlock() {
        const input = document.getElementById("passInput").value;
        if (input === "nguyenthilai") {
          document.getElementById("overlay").style.display = "none";
          document.getElementById("content").style.display = "block";
          document.getElementById("content").focus();
          document.getElementById("content").style.display = "block";
          document.querySelector(".graduation-card").classList.add("open-card");

          createContinuousConfetti();
        } else {
          alert("🔐 Sai mật khẩu rồi! Hãy thử lại nhé 💡");
        }
      }

      function createContinuousConfetti() {
        const colors = [
          "#fd79a8",
          "#fdcb6e",
          "#00cec9",
          "#74b9ff",
          "#a29bfe",
          "#ff7675",
          "#55efc4",
        ];
        setInterval(() => {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.position = "fixed";
          confetti.style.left = Math.random() * 100 + "%";
          confetti.style.top = "-10px";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.pointerEvents = "none";
          confetti.style.zIndex = "10";
          confetti.style.animationDuration = Math.random() * 2 + 2 + "s";
          document.body.appendChild(confetti);
          setTimeout(() => {
            if (confetti.parentNode) {
              confetti.parentNode.removeChild(confetti);
            }
          }, 4000);
        }, 250);
      }

      // High-quality image download function
      document.getElementById("downloadImageBtn").onclick = async function () {
        const btn = document.getElementById("downloadImageBtn");

        // Disable button and show loading state
        btn.disabled = true;

        try {
          const card = document.getElementById("captureArea");

          // Update progress - preparing

          // Small delay to ensure all fonts and styles are loaded
          await new Promise((resolve) => setTimeout(resolve, 300));

          // Update progress - capturing

          // Capture with high quality settings
          const canvas = await html2canvas(card, {
            backgroundColor: null, // Keep transparent background
            useCORS: true,
            allowTaint: false,
            scale: 2, // Higher resolution - 2x scaling
            logging: false,
            width: card.offsetWidth,
            height: card.offsetHeight,
            windowWidth: document.body.scrollWidth,
            windowHeight: document.body.scrollHeight,
            removeContainer: false,
            imageTimeout: 15000,
            onclone: function (clonedDoc) {
              // Ensure all styles are applied in the cloned document
              const clonedCard = clonedDoc.querySelector(".graduation-card");
              if (clonedCard) {
                clonedCard.style.animation = "none";
                // Stop all animations for better capture
                const animatedElements = clonedDoc.querySelectorAll("*");
                animatedElements.forEach((el) => {
                  el.style.animation = "none";
                  el.style.transition = "none";
                });
              }
            },
          });

          // Convert to high-quality blob
          canvas.toBlob(
            function (blob) {
              // Create download link
              const url = URL.createObjectURL(blob);
              const link = document.createElement("a");
              link.href = url;
              link.download = "thiep-chuc-mung-tot-nghiep.png";
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);

              // Reset button state
              setTimeout(() => {
                btn.disabled = false;
                icon.textContent = "✅";
                text.textContent = "Tải xong! Nhấn để tải lại";

                setTimeout(() => {
                  icon.textContent = "📸";
                  text.textContent = "Tải Ảnh Thiệp";
                }, 2500);
              }, 500);
            },
            "image/png",
            1.0
          ); // Maximum quality PNG
        } catch (error) {
          console.error("Error creating image:", error);

          // Reset button on error
          btn.disabled = false;
          icon.textContent = "❌";
          text.textContent = "Lỗi! Thử lại";

          setTimeout(() => {
            icon.textContent = "📸";
            text.textContent = "Tải Ảnh Thiệp";
          }, 5000);

          alert("Có lỗi xảy ra khi tạo ảnh. Vui lòng thử lại!");
        }
      };

      document.getElementById("shareBtn").onclick = async function () {
        try {
          const url = window.location.href;
          await navigator.clipboard.writeText(url);
          const btn = document.getElementById("shareBtn");
          const original = btn.textContent;
          btn.textContent = "✅";
          setTimeout(() => {
            btn.textContent = original;
          }, 1500);
          alert("📎 Đã sao chép link! Bạn có thể chia sẻ ngay.");
        } catch (err) {
          alert("Không thể sao chép liên kết. Trình duyệt không hỗ trợ!");
        }
      };

      // Auto-focus password input
      window.onload = function () {
        document.getElementById("passInput").focus();
      };
    </script>
  </body>
</html>
